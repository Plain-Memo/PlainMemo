<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quick Memo</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1e1e1e;
            --gutter-bg: #252526;
            --text-color: #d4d4d4;
            --line-number-color: #858585;
            --accent-color: #4fc3f7;
            --font-family: 'JetBrains Mono', monospace;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            /* スマホでのバウンススクロールを防止 */
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        .container { 
            display: flex; 
            /* ステータスバーとiOSのセーフエリアを考慮 */
            height: calc(100svh - 40px); 
            width: 100%; 
        }

        #line-numbers {
            width: 45px; padding: 20px 0; text-align: right;
            background-color: var(--gutter-bg); color: var(--line-number-color);
            font-size: 14px; line-height: 1.6; user-select: none; overflow: hidden;
            border-right: 1px solid #333;
        }

        #editor {
            flex: 1; padding: 20px; border: none; outline: none;
            background: transparent; color: inherit; font-family: inherit;
            font-size: 16px; line-height: 1.6; resize: none;
            /* スマホでズレないよう、あえて折り返しを無効化（横スクロール） */
            /* もし自動改行させたい場合は white-space: pre-wrap ですが行番号とズレます */
            white-space: pre; 
            overflow: auto;
            -webkit-appearance: none; /* iOSのデフォルトスタイル解除 */
        }

        .status-bar {
            height: 40px; background: #333;
            display: flex; justify-content: space-between;
            align-items: center; padding: 0 15px; font-size: 12px; color: #aaa;
            box-sizing: border-box;
        }

        .controls { display: flex; align-items: center; }

        .controls button {
            background: #444; border: 1px solid #555; color: #eee;
            padding: 5px 10px; cursor: pointer; font-size: 11px;
            border-radius: 3px; margin-left: 10px;
            /* スマホで押しやすいサイズ感 */
            min-height: 28px;
        }

        @media (hover: hover) {
            .controls button:hover { background: var(--accent-color); color: #000; }
        }

        /* スマホ向けに文字サイズを微調整 */
        @media (max-width: 600px) {
            #line-numbers { width: 35px; font-size: 12px; }
            #editor { font-size: 14px; padding: 15px; }
            #stats { display: none; } /* スマホでは文字数情報を簡略化 */
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="line-numbers">1</div>
        <textarea id="editor" spellcheck="false" autocomplete="off" placeholder="入力を開始..."></textarea>
    </div>

    <div class="status-bar">
        <span id="stats">Lines: 1 | Chars: 0</span>
        <div class="controls">
            <button onclick="downloadText()">Save (.txt)</button>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const lineNumbers = document.getElementById('line-numbers');
        const stats = document.getElementById('stats');

        function updateEditor() {
            const text = editor.value;
            const lines = text.split('\n');
            lineNumbers.innerText = Array.from({length: lines.length}, (_, i) => i + 1).join('\n');
            stats.innerText = `Lines: ${lines.length} | Chars: ${text.length}`;
            localStorage.setItem('quick-memo-v5', text);
        }

        function getTimestampFilename() {
            const now = new Date();
            const pad = (n) => String(n).padStart(2, '0');
            return `memo_${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}.txt`;
        }

        function downloadText() {
            const text = editor.value;
            if (!text) return;
            const blob = new Blob([text], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = getTimestampFilename();
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
            setTimeout(() => window.URL.revokeObjectURL(anchor.href), 100);
        }

        editor.addEventListener('input', updateEditor);
        
        // スクロールの同期（縦・横両方）
        editor.addEventListener('scroll', () => {
            lineNumbers.scrollTop = editor.scrollTop;
        });

        window.onload = () => {
            const savedData = localStorage.getItem('quick-memo-v5');
            if (savedData) {
                editor.value = savedData;
                updateEditor();
            }
        };
    </script>
</body>
</html>